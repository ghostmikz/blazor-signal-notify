@page "/request-portal"
@inject IJSRuntime JS
@inject HttpClient Http

<h1>HR Request Portal</h1>

<div class="row">
    <div class="col-md-6">
        <div class="card p-3 shadow-sm">
            <h3>Manager Setup</h3>
            <button class="btn btn-primary" @onclick='() => Subscribe("Manager")'>
                Enable Manager Alerts
            </button>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card p-3 shadow-sm border-warning">
            <h3>Employee Action</h3>
            @* The button now calls the silent method *@
            <button class="btn btn-warning" @onclick="SendRequest">
                Send Leave Request
            </button>
        </div>
    </div>
</div>

@code {
    private async Task Subscribe(string role)
    {
        var permission = await JS.InvokeAsync<string>("Notification.requestPermission");
        if (permission == "granted")
        {
            var sub = await JS.InvokeAsync<object>("blazorPushNotifications.requestSubscription");
            await Http.PostAsJsonAsync($"api/notifications/subscribe/{role}", sub);
        }
    }

    private async Task SendRequest()
    {
        // This now runs silently in the background
        await Http.PostAsync("api/notifications/request-leave", null);
        
        // I removed the JS.InvokeVoidAsync("alert", ...) line from here
        Console.WriteLine("C#: Request sent silently to server.");
    }
}